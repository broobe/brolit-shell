# TODO List

## For release 3.1

### Know Bugs

- [ ] Nginx: If you put a root domain to create a new project, it should ask you if you want to use www subdomain.
        Also, if you use www, it should ask you if you want to use the root domain too.
- [ ] When restore a backup and change project_name or/and project_domain the script fails:
        - If the main domain detected is a root-domain like mydomain.com the "search and replace" 
          will replace https://www.mydomain.com by https://www.test.mydomain.com
        - If decide to generate new certificate on root-domain, it fails to generate nginx config
- [ ] Project Utils: Delete doesn't work on tools (netdata, phpmyadmin).
- [ ] Notifications: Email HTML breaks sometimes.
- [ ] LetsEncrypt: when delete a certificate, nginx config fails.
- [ ] Cloudflare: if migrate a site with certificates generated by python3-certbot-cloudflare, the certbot will fail.
      Maybe we could ask if it has the proxy enable via Cloudflare API and disable before generate new certificates.

### Need improvements

- [ ] Core: need to check if select domain is a root domain or www domain, and ask if the user want to create a redirection.
- [ ] Core: create a way to check if nginx, php, and other parameters are correct before run the script.
- [ ] Nginx-LetsEncrypt: regenerate nginx server configuration projects fails after running certbot.
- [ ] Nginx-LetsEncrypt: When copy or generate a new nginx server configuration need to check certificates.
- [ ] LetsEncrypt: need a better way to re-install a certificate after a website migration.
- [ ] Project: on project delete, if the script can't find the user, maybe it will be better list all mysql users with database permision (before database deletion).
- [ ] WordPress: WP-CLI should not be required if server type != webserver.

### Need more testing

- [ ] Nginx: Globals configs support.
- [ ] PHP: Option to enable or disable OpCache.
- [ ] Backups: When restore or create a new project and the db_user already exists, we need to ask what todo (new user or continue?).
- [ ] Installers: On LEMP setup, after basic installation must init plugin options wizard before ask to install aditional packages.

### In Progress

- [ ] Core: Generate project config file (/etc/brolit/domain_conf.json).
- [ ] Server Setup: option to run without menu.
        Example: ./runner.sh --task "server-setup" --mariadb "default" --mariadb-pass "root_pass" --nginx "default" --php "default" --certbot
- [ ] Core: On project creation/restore need to ask first the project state, then project domain.
        If project state != prod and subdomains is not containing the stage, need to suggest one.
        Example: test.multiplacas.broobe.hosting OK
        Example 2: multiplacas.broobe.hosting X (OK only if prod).
- [ ] WP-CLI: wpcli_search_and_replace receives domains instead urls (ex: domain.com instead http://domain.com).
- [ ] Restore-project: cant restore non-wp projects.
- [ ] Restore-database: granting privileges to user fails, database_name is empty.
- [ ] Core: Add support to create projects with differents roles. Exanple: webserver, database, replica, etc.
        Need to change if later the script detects a php, nginx o mysql installation.
        https://www.digitalocean.com/community/tutorials/automating-the-deployment-of-a-scalable-wordpress-site
        https://spinupwp.com/scaling-wordpress-dedicated-database-server/
- [ ] Nginx: Better nginx config. 
        Ref https://www.digitalocean.com/community/tools/nginx
- [ ] Nginx: At startup, check if nginx has globals installed.
- [ ] Project Utils: Add delete database and create database option.
- [ ] Cloudflare: the script should ask you if you want to work with Cloudflare support (also when you create a new project).
- [ ] WP-CLI: Better error handling.

### Done âœ“

- [x] WordPress: support for multiple WP installations inside the main project directory.
- [x] Nginx: New option to put a website offline/online.
- [x] Log/Display: Better log handling and display improvements.
- [x] When a certificate expired, the email subject didn't show the Warning message.
- [x] Project Utils: A new option "Create project database" to create a database, and a database user for an specific project.
- [x] MySQL: when create a new user, ask what kind of connection do you want: localhost or % (any host).
- [x] Notifications: malware scans and others scheduled options.

## For release 3.2

- [ ] Core: Let configure temp. backup directory.
- [ ] Core: Docker support (backup, restore, list containers, status).
- [ ] Core: Refactor settings config (change to a json config file?).
- [ ] Core: Resolve small "TODOs" comments on the project.
- [ ] Core: Prevent execute the script more than once at a time (maybe a .lock file?).
- [ ] Core: Complete refactor of script_configuration_wizard.
- [ ] Core: Better structure of deleted projects on dropbox.
- [ ] Core: Add an option to backup all and prepare VPS to be offline/deleted (add a VPS offline structure on dropbox).
- [ ] Core: make new standard directory structure for projects "${SITES}/${ROOT_DOMAIN}/${SUBDOMAIN}/public". ?
      Logs could be stored on "${SITES}/${ROOT_DOMAIN}/${SUBDOMAIN}/log"
- [ ] Core: maybe with could ask for database user nomenclature. Today is "PROJECTNAME_user" and it could be "PROJECTNAME_PROJECTSTATE_user".
- [ ] Backups: Refactor for backup/restore: 5 options (server_config, site_config, site, database and project).
- [ ] Restore: Finish function restore_config_files_from_dropbox.
- [ ] MySQL: Rename database (with and without WP).

## For release 3.3

- [ ] Firewall: ufw support.
- [ ] Core: Complete refactor of script_configuration_wizard.
- [ ] Notifications: After install a new project (with credentials info).
- [ ] Backups: On backup failure, the email must show what files fails and what files are correct backuped.
- [ ] Backups: Implement on restore_from_backup easy way to restore all sites.
- [ ] Scheduled options: backups, malware scans, image optimizations and wp actions (core and plugins updates, checksum and wp re-installation).
- [ ] Refactor of RESTORE_FROM_SOURCE and complete server config restore.
- [ ] Nginx: Multidomain support for nginx.
- [ ] Nginx: Add http2 support on nginx server config files.
- [ ] Nginx: New option to put website on maintenance (maybe rename index.html/php and create a new HTML).
- [ ] Wordpress: Rollback plugins and core updates (wpcli_rollback_plugin_version)
- [ ] SFTP: Option to create a user jail on sftp_create_user.
        Important:https://www.electricmonk.nl/log/2015/07/13/ssh-chrootdirectory-sftponly-not-working-fixed/
- [ ] Core: Add react-project support:
        https://www.digitalocean.com/community/tutorials/how-to-deploy-a-react-application-with-nginx-on-ubuntu-20-04

## For release 3.4

- [ ] Configuration: Let configure all things via JSON files.
- [ ] PHP: php_reconfigure refactor (replace strings instead of replace entired config files).
- [ ] WordPress: Fallback for replace strings on wp database (if wp-cli fails, use old script version).
- [ ] Wordpress: When restore or create a project on PROD state, ask if want to run "wpcli_run_startup_script"
- [ ] Installers: Refactor of WORDPRESS_INSTALLER - COPY_FROM_PROJECT
        The idea is that you could create/copy/delete/update different kind of projects (WP, Laravel, React, Composer, Empty)
        Maybe add this for Laravel: https://gitlab.com/broobe/laravel-boilerplate/-/tree/master
        Important: if create a project with stage different than prod, block search engine indexation
- [ ] Installers: COPY_FROM_PROJECT option to exclude uploads directory
        rsync -ax --exclude [relative path to directory to exclude] /path/from /path/to
- [ ] Hetzner cloud cli support: https://github.com/hetznercloud/cli
- [ ] Network: implements hetzner network configuration.
      https://docs.hetzner.com/cloud/networks/server-configuration/

## For release 3.5

- [ ] Backups: Support for dailys, weeklys y monthlys backups.
- [ ] Backups: Directory Blacklist with whiptail (for backup configuration).
- [ ] Server Optimization: Complete the pdf optimization process.
- [ ] MySQL: Optimization script.
- [ ] Woocommerce support: https://github.com/woocommerce/woocommerce/wiki/WC-CLI-Commands
- [ ] Buddypress support: https://github.com/buddypress/wp-cli-buddypress
- [ ] IT Utils: Control of mounted partitions or directories.
- [ ] IT Utils: Better malware detection with https://github.com/rfxn/linux-malware-detect
- [ ] Addon: Fileover support with hetzner? https://community.hetzner.com/tutorials/failover-script

## For release 3.6

- [ ] Backups: Expand Duplicity support with a restore option.
- [ ] Backups: Rsync support on mounted device or with SSH config.
- [ ] PHP: Option to change php version on installed site.
        https://easyengine.io/blog/easyengine-v4-0-15-released/
- [ ] Installers: Option to select netdata metrics to be reported.
- [ ] Installers: Netdata Discord support
        https://docs.netdata.cloud/health/notifications/discord/
- [ ] Security: Option to auto-install security updates on Ubuntu: 
        https://help.ubuntu.com/lts/serverguide/automatic-updates.html
- [ ] Installers: Mailcow installer and backup.
- [ ] Include network (lan and internet) tests with iperf and speedtest-cli.
- [ ] Moodle Support: https://websiteforstudents.com/how-to-install-moodle-on-ubuntu-20-04-18-04-with-nginx-and-lets-encrypt/
      Moodle data must be on independent directory (need to implements backup/restore support too)
- [ ] Support for rclone: https://github.com/rclone/rclone
      Add support to others storage service (Google Drive, SFTP, etc)

## For release 4.0

- [ ] Cloud-init support?
- [ ] HTTP/2 Monitor Dashboard.
- [ ] Uptime Kuma support: 
        https://github.com/louislam/uptime-kuma
- [ ] Docker support: 
        https://docs.docker.com/desktop/backup-and-restore/
        https://www.reddit.com/r/Wordpress/comments/jfn7z9/guide_wordpress_on_docker_with_nginx_traefik/
- [ ] WordPress: WP Network support (nginx config, and wp-cli commands).
- [ ] Support for borgmatic?: https://github.com/witten/borgmatic
- [ ] Core: Accept command via Telegram: https://github.com/topkecleon/telegram-bot-bash
- [ ] Nginx: bad bot blocker.
      https://github.com/mitchellkrogza/nginx-ultimate-bad-bot-blocker